
┌──────────────────────────────────────────────────────────────────────────────────────┐   ┌─────────────────────┐
│  Frontend                                                                            │   │  MLflow UI          │  :5000
│                                                                                      │   │  experiment tracking│
│  ┌───────────────────────┐    ┌───────────────────────────────────────────────────┐  │   ├─────────────────────┤
│  │ app.py  (sidebar)     │    │  Port: 8501  — Streamlit                          │  │   │  Prefect UI         │  :4200
│  │ ─────────────────     │    │  ┌─────────────────────────────────────────────┐  │  │   │  flow runs/schedules│
│  │ 0. Project Overview   │    │  │  src/dashboard/utils/api_client.py          │  │  │   ├─────────────────────┤
│  │ 1. Dashboard          │    │  │  GET  /topics  /trends  /alerts             │  │  │   │  Backend API docs   │  :8000
│  │ 2. Topic Drilldown    │    │  │  GET  /bertopic  /lda  /batch-stats         │  │  │   │  /docs  (Swagger)   │
│  │ 3. Drift Alerts       │    │  │  POST /infer  /hitl/merge  /hitl/relabel    │  │  │   │                     │
│  │ 4. HITL Editor        │    │  └─────────────────────────────────────────────┘  │  │   └─────────────────────┘
│  │ 5. Inference          │    └───────────────────────────────────────────────────┘  │
│  │ 6. Model Benchmarking │              ↑  dashed  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─►│
│  └───────────────────────┘                                                           │
├──────────────────────────────────────────────────────────────────────────────────────┤
│  Backend                                                                             │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐  │
│  │  ETL — complete_pipeline_flow  (Prefect master flow)                          │  │
│  │                                                                                │  │
│  │  ┌──────────────────────┐   ┌──────────────────────────────────────────────┐  │  │
│  │  │ data                 │   │  ML                                          │  │  │
│  │  │ data_ingestion_flow  │   │                                              │  │  │
│  │  │ ─────────────────    │   │  ┌────────────────────────────────────────┐  │  │  │
│  │  │ load_data_window     │──►│  │  bertopic_modeling_flow                │  │  │  │
│  │  │ clean_text_column    │   │  │  ──────────────────────────────────    │  │  │  │
│  │  │ add_document_ids     │   │  │  train_seed_model_task (batch 1)       │  │  │  │
│  │  │ validate_data        │   │  │    OR                                  │  │  │  │
│  │  │ save_to_parquet      │   │  │  train_batch_and_merge_models_task     │  │  │  │
│  │  │                      │   │  │  ─────────────────────────────────     │  │  │  │
│  │  │ → data/processed/    │   │  │  SentenceTransformer all-MiniLM-L6-v2  │  │  │  │
│  │  │   *.parquet          │   │  │  UMAP n_neighbors=15 n_components=5    │  │  │  │
│  │  └──────────────────────┘   │  │  HDBSCAN min_cluster_size=15           │  │  │  │
│  │                             │  │  c-TF-IDF + CountVectorizer(1,2)gram   │  │  │  │
│  │                             │  │  merge_models() cumulative             │  │  │  │
│  │                             │  │  Ollama gemma3:1b → auto labels        │  │  │  │
│  │                             │  │  ─────────────────────────────────     │  │  │  │
│  │                             │  │  Metrics (shared tokens with LDA):     │  │  │  │
│  │                             │  │  calculate_bertopic_coherence_task     │  │  │  │
│  │                             │  │    shared: simple_preprocess +         │  │  │  │
│  │                             │  │    WordNetLemmatizer no_below=5        │  │  │  │
│  │                             │  │  calculate_bertopic_silhouette_task    │  │  │  │
│  │                             │  │    cosine on 384-dim embeddings        │  │  │  │
│  │                             │  │  diversity: unique_kw/total_kw         │  │  │  │
│  │                             │  └────────────────────────────────────┘  │  │  │  │
│  │                             │                                            │  │  │  │
│  │                             │  ┌────────────────────────────────────┐   │  │  │  │
│  │                             │  │  lda_comparison_flow               │   │  │  │  │
│  │                             │  │  ──────────────────────────────    │   │  │  │  │
│  │                             │  │  preprocess_documents_for_lda      │   │  │  │  │
│  │                             │  │    simple_preprocess + lemmatize   │   │  │  │  │
│  │                             │  │    no_below=5 no_above=0.5         │   │  │  │  │
│  │                             │  │    keep_n=10000                    │   │  │  │  │
│  │                             │  │  train_lda_model_task              │   │  │  │  │
│  │                             │  │    LdaModel alpha=auto eta=auto    │   │  │  │  │
│  │                             │  │    passes=10 iterations=200        │   │  │  │  │
│  │                             │  │    chunksize=100                   │   │  │  │  │
│  │                             │  │    num_topics = BERTopic count     │   │  │  │  │
│  │                             │  │  calculate_coherence_task          │   │  │  │  │
│  │                             │  │    SAME shared tokens as BERTopic  │   │  │  │  │
│  │                             │  │  calculate_diversity_task          │   │  │  │  │
│  │                             │  │    unique_words/total top-10       │   │  │  │  │
│  │                             │  │  calculate_silhouette_task         │   │  │  │  │
│  │                             │  │    TF-IDF 1000-dim cosine          │   │  │  │  │
│  │                             │  └────────────────────────────────────┘  │  │  │  │
│  │                             │                                            │  │  │  │
│  │                             │  ┌────────────────────────────────────┐   │  │  │  │
│  │                             │  │  Drift                             │   │  │  │  │
│  │                             │  │  drift_detection_flow              │   │  │  │  │
│  │                             │  │  ──────────────────────────────    │   │  │  │  │
│  │                             │  │  prevalence drift    ≥ 0.25        │   │  │  │  │
│  │                             │  │  centroid drift      ≥ 0.55        │   │  │  │  │
│  │                             │  │  JS divergence       ≥ 0.40        │   │  │  │  │
│  │                             │  │  new topics appeared ≥ 10          │   │  │  │  │
│  │                             │  │  topics disappeared  ≥ 6           │   │  │  │  │
│  │                             │  └────────────────────────────────────┘  │  │  │  │
│  │                             └──────────────────────────────────────────┘  │  │  │
│  └────────────────────────────────────────────────────────────────────────────┘  │  │
│            │                                                                      │  │
│            ▼                                                                      │  │
│  ┌───────────────────────────────────────────────┐   ┌────────────────────────┐  │  │
│  │  Storage / output  (local)                    │   │  FastAPI  :8000        │  │  │
│  │  ─────────────────────────────────────────    │   │  ─────────────────     │  │  │
│  │  models/current/bertopic_model.pkl            │   │  /api/v1/topics        │  │  │
│  │  models/previous/bertopic_model.pkl           │◄──│  /api/v1/trends        │  │  │
│  │  models/current/bertopic_model_corpus.json    │   │  /api/v1/alerts        │  │  │
│  │  outputs/topics/topics_metadata.json          │──►│  /api/v1/infer         │  │  │
│  │  outputs/assignments/doc_assignments.csv      │   │  /api/v1/hitl          │  │  │
│  │  outputs/metrics/bertopic_metrics.json        │   │    merge/relabel/audit │  │  │
│  │  outputs/metrics/lda_metrics.json             │   │  /api/v1/bertopic      │  │  │
│  │  outputs/alerts/drift_alerts.csv              │   │  /api/v1/lda           │  │  │
│  │  outputs/audit/hitl_audit_log.csv             │   │  /api/v1/batch-stats   │  │  │
│  │  data/state/processing_state.json             │   │  /api/v1/pipeline      │  │  │
│  └───────────────────────────────────────────────┘   │    /status             │  │  │
│                                                       └────────────────────────┘  │  │
│  ┌─────────────────────────────┐                                ▲                  │  │
│  │  Ollama  (local)            │                                │                  │  │
│  │  model: gemma3:1b           │                                │                  │  │
│  │  input:  c-TF-IDF keywords  │                                │                  │  │
│  │  output: 3-6 word label +   │                                │                  │  │
│  │          one-line summary   │────────────────────────────────┘                  │  │
│  └─────────────────────────────┘                                                   │  │
│                                                                                     │  │
│  ┌──────────────────────┐                                                           │  │
│  │  HITL operations     │                                                           │  │
│  │  → merge_topics()    │                                                           │  │
│  │  → set_topic_labels()│                                                           │  │
│  │  → audit log (csv)   │                                                           │  │
│  └──────────────────────┘                                                           │  │
└─────────────────────────────────────────────────────────────────────────────────────┘  │
